<!-- pages/index/index.wxml -->
<view class="container">
  <!-- æœ‰å‡ºç”Ÿä¿¡æ¯æ—¶ï¼šæ˜¾ç¤ºä¸ªäººæ˜Ÿç›˜æ¦‚è§ˆ -->
  <view wx:if="{{hasBirthInfo && birthInfo}}" class="profile-view">
    <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
    <view class="profile-card">
      <view class="profile-header">
        <view class="avatar">
          <text class="avatar-icon">{{getSunSignSymbol()}}</text>
        </view>
        <view class="profile-info">
          <text class="profile-name">æˆ‘çš„æ˜Ÿç›˜</text>
          <text class="profile-date">{{formatBirthInfo()}}</text>
        </view>
        <view class="edit-btn" bind:tap="goToInput">
          <text class="edit-icon">âœï¸</text>
        </view>
      </view>

      <!-- æ ¸å¿ƒä¸‰æ˜Ÿåº§ -->
      <view class="core-signs" wx:if="{{chartData}}">
        <view class="sign-item">
          <text class="sign-label">å¤ªé˜³</text>
          <text class="sign-symbol">{{getSunSign().symbol}}</text>
          <text class="sign-name">{{getSunSign().name}}</text>
        </view>
        <view class="sign-item">
          <text class="sign-label">æœˆäº®</text>
          <text class="sign-symbol">{{getMoonSign().symbol}}</text>
          <text class="sign-name">{{getMoonSign().name}}</text>
        </view>
        <view class="sign-item">
          <text class="sign-label">ä¸Šå‡</text>
          <text class="sign-symbol">{{getAscSign().symbol}}</text>
          <text class="sign-name">{{getAscSign().name}}</text>
        </view>
      </view>
    </view>

    <!-- å¿«é€Ÿä¿¡æ¯ -->
    <view class="quick-info" wx:if="{{chartData}}">
      <view class="info-row">
        <view class="info-item">
          <text class="info-value">{{chartData.planets ? chartData.planets.length : 0}}</text>
          <text class="info-label">è¡Œæ˜Ÿ</text>
        </view>
        <view class="info-item">
          <text class="info-value">12</text>
          <text class="info-label">å®«ä½</text>
        </view>
        <view class="info-item">
          <text class="info-value">{{chartData.aspects ? chartData.aspects.length : 0}}</text>
          <text class="info-label">ç›¸ä½</text>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <view class="action-btn" bind:tap="goToInput">
        <text class="btn-icon">âœï¸</text>
        <text class="btn-text">ç¼–è¾‘ä¿¡æ¯</text>
      </view>
      <view class="action-btn primary" bind:tap="goToChart">
        <text class="btn-icon">â­</text>
        <text class="btn-text">æŸ¥çœ‹æ˜Ÿç›˜</text>
      </view>
    </view>
  </view>

  <!-- æ²¡æœ‰å‡ºç”Ÿä¿¡æ¯æ—¶ï¼šæ˜¾ç¤ºæ¬¢è¿ç•Œé¢ -->
  <view wx:else class="welcome-view">
    <view class="welcome-header">
      <text class="welcome-title">æ˜Ÿç›˜æµ‹ç®—ç³»ç»Ÿ</text>
      <text class="welcome-subtitle">æ¢ç´¢å®‡å®™ï¼Œè®¤è¯†è‡ªæˆ‘</text>
    </view>

    <view class="welcome-content">
      <view class="welcome-illustration">
        <text class="illustration-symbol">â™ˆâ™‰â™Šâ™‹â™Œâ™â™â™â™â™‘â™’â™“</text>
      </view>

      <text class="welcome-desc">
        è¾“å…¥æ‚¨çš„å‡ºç”Ÿä¿¡æ¯ï¼Œç”Ÿæˆä¸“å±æœ¬å‘½æ˜Ÿç›˜ï¼Œè§£è¯»è¡Œæ˜Ÿä½ç½®ã€å®«ä½åˆ†å¸ƒå’Œç›¸ä½å…³ç³»
      </text>

      <view class="create-btn" bind:tap="goToInput">
        <text class="create-icon">âœ¨</text>
        <text class="create-text">åˆ›å»ºæˆ‘çš„æ˜Ÿç›˜</text>
      </view>
    </view>

    <view class="feature-hints">
      <view class="hint-item">
        <text class="hint-icon">ğŸ“Š</text>
        <text class="hint-text">ç²¾ç¡®è¡Œæ˜Ÿè®¡ç®—</text>
      </view>
      <view class="hint-item">
        <text class="hint-icon">ğŸ </text>
        <text class="hint-text">å¤šç§å®«ä½åˆ¶</text>
      </view>
      <view class="hint-item">
        <text class="hint-icon">ğŸ”®</text>
        <text class="hint-text">ä¸“ä¸šè§£è¯»</text>
      </view>
      <view class="hint-item">
        <text class="hint-icon">ğŸŒ</text>
        <text class="hint-text">åœ°ç†ä½ç½®</text>
      </view>
    </view>
  </view>

  <!-- ä¼ ç»Ÿæ¶ˆæ¯è°ƒè¯•ç•Œé¢ -->
  <view class="debug-section">
    <!-- æ ‡é¢˜ -->
    <view class="section-title">
      <text>WebSocket è°ƒè¯•</text>
    </view>
    <!-- é¡¶éƒ¨è¿æ¥çŠ¶æ€ -->
    <view class="status-bar">
      <view class="status-info">
        <text class="status-label">ç¯å¢ƒ: </text>
        <text class="status-value">{{ envName }}</text>
      </view>
      <view class="status-info">
        <text class="status-label">æœåŠ¡: </text>
        <text class="status-value">{{ serviceName }}</text>
      </view>
      <view class="status-info">
        <text class="status-label">çŠ¶æ€: </text>
        <text class="{{ connected ? 'status-connected' : 'status-disconnected' }}">
          {{ connected ? 'å·²è¿æ¥' : 'æœªè¿æ¥' }}
        </text>
      </view>
    </view>

    <!-- è¿æ¥/æ–­å¼€æŒ‰é’® -->
    <view class="control-buttons">
      <button
        class="{{ connected ? 'btn-connected' : 'btn-disconnected' }}"
        bind:tap="{{ connected ? 'disconnect' : 'connectCloud' }}"
      >
        {{ connected ? 'æ–­å¼€è¿æ¥' : 'è¿æ¥äº‘æœåŠ¡' }}
      </button>
    </view>

    <!-- æ¶ˆæ¯åˆ—è¡¨ -->
    <scroll-view
      id="message-list"
      class="message-list"
      scroll-y
      scroll-into-view="msg-{{messages.length}}"
    >
      <view class="message-item" wx:for="{{messages}}" wx:key="index" id="msg-{{index}}">
        <view class="message-time">{{item.time}}</view>
        <view class="message-content {{item.type}}">
          {{item.text}}
        </view>
      </view>
    </scroll-view>

    <!-- åº•éƒ¨è¾“å…¥åŒºåŸŸ -->
    <view class="input-area">
      <input
        class="input-box"
        placeholder="è¯·è¾“å…¥æ¶ˆæ¯..."
        value="{{inputMessage}}"
        bind:input="onInput"
        confirm-type="send"
        bind:confirm="sendMessage"
      />
      <button class="send-btn" bind:tap="sendMessage">å‘é€</button>
      <button class="clear-btn" bind:tap="clearMessages">æ¸…ç©º</button>
    </view>
  </view>
</view>
