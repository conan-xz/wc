<!-- pages/astrology-input/astrology-input.wxml -->
<view class="page-container">
  <view class="card">
    <view class="card-title">å‡ºç”Ÿä¿¡æ¯å½•å…¥</view>

    <!-- å‡ºç”Ÿæ—¥æœŸ -->
    <view class="form-item">
      <text class="form-label">å‡ºç”Ÿæ—¥æœŸ *</text>
      <picker
        mode="date"
        value="{{birthDate}}"
        end="{{currentDate}}"
        bind:change="onDateChange"
      >
        <view class="picker">
          {{birthDate || 'è¯·é€‰æ‹©å‡ºç”Ÿæ—¥æœŸ'}}
        </view>
      </picker>
    </view>

    <!-- å‡ºç”Ÿæ—¶é—´ -->
    <view class="form-item">
      <text class="form-label">å‡ºç”Ÿæ—¶é—´ *</text>
      <picker
        mode="time"
        value="{{birthTime}}"
        bind:change="onTimeChange"
      >
        <view class="picker">
          {{birthTime || 'è¯·é€‰æ‹©å‡ºç”Ÿæ—¶é—´'}}
        </view>
      </picker>
      <view class="time-warning" wx:if="{{timeUncertain}}">
        <text class="warning-icon">âš ï¸</text>
        <text class="warning-text">æ—¶é—´ä¸ç¡®å®šåº¦è¶…è¿‡15åˆ†é’Ÿï¼Œå¯èƒ½å½±å“ç²¾åº¦</text>
      </view>
    </view>

    <!-- æ—¶é—´ä¸ç¡®å®šåº¦ -->
    <view class="form-item">
      <text class="form-label">æ—¶é—´ä¸ç¡®å®šåº¦ï¼ˆå¯é€‰ï¼‰</text>
      <picker
        mode="selector"
        range="{{timeUncertaintyOptions}}"
        bind:change="onUncertaintyChange"
      >
        <view class="picker">
          {{timeUncertaintyOptions[timeUncertaintyIndex] || 'ä¸ç¡®å®š'}}
        </view>
      </picker>
    </view>

    <!-- å‡ºç”Ÿåœ°ç‚¹ -->
    <view class="form-item">
      <text class="form-label">å‡ºç”Ÿåœ°ç‚¹ *</text>
      <view class="location-input-wrapper">
        <input
          class=""
          type="text"
          placeholder="è¾“å…¥åŸå¸‚åç§°"
          value="{{searchQuery}}"
          bind:input="onSearchInput"
        />
        <button class="search-btn" bind:tap="searchCity">æœç´¢</button>
      </view>
    </view>

    <!-- åŸå¸‚æœç´¢ç»“æœ -->
    <view class="city-results" wx:if="{{cityResults.length > 0}}">
      <view
        class="city-item"
        wx:for="{{cityResults}}"
        wx:key="index"
        bind:tap="selectCity"
        data-city="{{item}}"
      >
        <view class="city-info">
          <text class="city-name">{{item.name}}</text>
          <text class="city-detail">{{item.country}}</text>
        </view>
        <view class="city-coords">
          <text class="coords-text">{{formatCoords(item.lat, item.lng)}}</text>
        </view>
      </view>
    </view>

    <!-- å·²é€‰åœ°ç‚¹ -->
    <view class="selected-location" wx:if="{{location.city}}">
      <view class="location-info">
        <text class="location-icon">ğŸ“</text>
        <view class="location-detail">
          <text class="location-city">{{location.city}}</text>
          <text class="location-coords">{{formatCoords(location.lat, location.lng)}}</text>
        </view>
      </view>
    </view>

    <!-- æ—¶åŒº -->
    <view class="form-item" wx:if="{{timeZone}}">
      <text class="form-label">æ—¶åŒº</text>
      <view class="timezone-display">
        <text>UTC{{timeZone >= 0 ? '+' : ''}}{{timeZone}}</text>
        <text class="timezone-name">{{timeZoneName}}</text>
      </view>
    </view>

    <!-- æäº¤æŒ‰é’® -->
    <button class="btn btn-primary btn-block btn-large" bind:tap="submit">
      ç”Ÿæˆæ˜Ÿç›˜
    </button>
  </view>

  <!-- å†å²è®°å½• -->
  <view class="card" wx:if="{{history.length > 0}}">
    <view class="card-title">å†å²è®°å½•</view>
    <view class="history-list">
      <view
        class="history-item"
        wx:for="{{history}}"
        wx:key="index"
        bind:tap="useHistory"
        data-item="{{item}}"
      >
        <view class="history-info">
          <text class="history-date">{{formatDate(item.birthDate)}}</text>
          <text class="history-time">{{item.birthTime}}</text>
          <text class="history-location">{{item.location.city}}</text>
        </view>
      </view>
    </view>
  </view>
</view>